\documentclass{llncs}

%%%%%%%%%%%%%%%%%%%
%%% Packages
%%%%%%%%%%%%%%%%%%%
\usepackage[backend=biber, style=lncs]{biblatex}
\addbibresource{ref.bib}
% !TEX TS-program = pdflatexmk

\usepackage{geometry}
\geometry{
  a4paper,         % or letterpaper
  textwidth=15cm,  % llncs has 12.2cm
  textheight=24cm, % llncs has 19.3cm
  hratio=1:1,      % horizontally centered
  vratio=2:3,      % not vertically centered
}

\usepackage[hidelinks]{hyperref}
\usepackage[parfill]{parskip} % noindent + space between paragraph (I really prefer...)
\usepackage[table]{xcolor}
\usepackage{subcaption}
\usepackage{amsmath}
\usepackage{amsfonts}
\usepackage{nicefrac}
\usepackage{hhline}
\usepackage{bigdelim}
\usepackage{booktabs}

\usepackage{float}
\usepackage{tcolorbox}
\tcbuselibrary{breakable, skins, theorems}

\newtcbtheorem{tcbexample}{Example}{
  breakable,
  enhanced,
  boxrule=0.15mm,
  colback=gray!15,
  colbacktitle=gray!15,
  coltitle=red!50!black,
  fonttitle=\bfseries,
  detach title,
  before upper={\tcbtitle},
  separator sign none,
  description delimiters={(}{). }
}{ex}

\usepackage{tikz}
\usetikzlibrary{intersections}
\usetikzlibrary{calc}
\usetikzlibrary{quantikz2}

\newcommand{\ketbra}[2]{\ensuremath{| #1 \rangle \langle #2 |}}
\newcommand{\ci}{\mathrm{i}}
\DeclarePairedDelimiter{\card}{\lvert}{\rvert}
\DeclarePairedDelimiter{\norm}{\lVert}{\rVert}
\DeclareMathOperator{\tr}{tr}
\newcommand{\cnot}{\mathit{CNOT}}

%%%%%%%%%%%%%%%%%%%
%%% General Cmds
%%%%%%%%%%%%%%%%%%%
\newcommand{\todo}[1]{{\color{red}\bfseries{}TODO: #1}}
  
\begin{document}
\title{Quantum Magic Games}

\author{Luigi Soares \and Roberto Rosmaninho}
\institute{%
  Department of Computer Science, UFMG - Brazil \\
  \email{\{luigi.domenico, robertogomes\}@dcc.ufmg.br}}

\maketitle
\begin{abstract}
This paper explores the phenomenon of quantum pseudo-telepathy, a form of communication that exhibits properties resembling telepathy by leveraging aspects of the quantum realm. Specifically, the focus is on the Mermin-Peres magic square game, which exemplifies quantum pseudo-telepathy and provides a simplified proof for the Kochen-Specker theorem. The paper begins by discussing various examples of quantum pseudo-telepathy games and their incompatibility with classical winning strategies, highlighting the necessity of prior entanglement between players. Additionally, it delves into the intricacies of the magic square game, classical approaches, the impossibility of consistent classical winning, and the rationale behind the successful implementation of a quantum strategy. Moreover, it explores the connection between the game and the proof of the incompatibility of noncontextual hidden-variable theories. Furthermore, a generalization of games similar to the magic square, proposed by Arkhipov, is presented. Ultimately, through this investigation, the paper sheds light on the fascinating realm of quantum pseudo-telepathy and its implications for our understanding of classical physics and quantum mechanics.
\end{abstract}

\section{Introduction}
\label{sec:intro}

Telepathy, the ability of transmitting information from one
person's mind to another's, would certainly come in handy in
many situations, right? Unfortunately (or not), (to the best
of our knowledge) telepathy is not a thing. At least, not
according to classical physics. Certain aspects of the
quantum realm, however, provide a way of communication that,
for a layman, may look as ``magical'', or as true telepathy. This
phenomenon is called quantum
\emph{pseudo-telepathy}~\cite{brassard:2005}.


Quantum pseudo-telepathy is observed in many contexts, usually
described in the format of a game. Examples of such games are: the
``impossible colouring games''~\cite{cleve:2004}, based on the
Kochen-Specker theorem~\cite{kochen:1967};
%% Avoid confusion with our definition of parity telepathy games
% the
% ``parity games'', in which \(n \geq 3\) players are given
% bit-strings and, without communicating to each other, they
% output one of their bits, winning if their outputs combined
% obey certain parity conditions~\cite{brassard:2005,
%   Mermin1990};
the ``Deutsch-Jozsa games''~\cite{brassard:1999}, based on the Deutsch-Jozsa problem~\cite{deutsch:1992};
% where Alice and Bob
% are given bit strings \(x\) and \(y\), and must output bit
% strings \(a\) and \(b\) such that \(a = b\) if and only if
% \(x = y\)~\cite{brassard:2005};
the ``magic square'' game~\cite{aravind:2002}, based on the Mermin-Peres proof of the
Kochen-Specker theorem~\cite{mermin:1990, peres:1990, mermin:1993, peres:1997}; and many
others~\cite{cleve:2004, brassard:2005}. None of these games admit a
classical winning strategy (i.e.\ is not possible to always win), yet
they can be won systematically, without any communication, provided
that the players are allowed to share prior entanglement~\cite{brassard:2005}.

In this project, we will explore the Mermin-Peres magic square game
(hereinafter referred simply as magic square). The origins of this
game date back to the ninities. It was first described in the works of
Mermin~\cite{mermin:1990, mermin:1993} and of
Peres~\cite{peres:1990, peres:1997}. Their results provided (as per the title of
Mermin's review letter) a simplied proof for the Kochen-Specker
theorem~\cite{kochen:1967}. Later, in 2002, Aravind demonstrated how
to transform Mermin-Peres's proof of the Kochen-Specker theorem into a
proof of Bell's theorem~\cite{aravind:2002}. Bell's
theorem~\cite{bell:1964} shows the incompatibility of hidden variables
(i.e. determinism) and locality, and Kochen-Specker's theorem
demonstrates the conflicting nature of determinism and
noncontextuality (locality can be regarded as a special case of
contextuality). These sort of results may seem
challenging, but their descriptions can be greatly simplified by
modeling them as quantum games.  In particular, it is extremely easy
to show that there cannot be a classical solution to the the magic
square game, and to convince an observer that something ``magical''
(classically impossible) is happening in a successful implementation
of a quantum winnin strategy~\cite{brassard:2005}.

\paragraph{Outline of this paper.}
In Section~\ref{sec:magic-square}, we detail the intrinsics of the
magic square game, classical approaches and why it is impossible to
systematically win the game classically, how and why the quantum
strategy works, and how to implement it. We also briefly discuss how
the game translates to the proof of incompatibility of a
noncontextual hidden-variable theory. Then, in
Section~\ref{sec:extending}, we describe a generalization of games
that follow the same style of the magic square game, given
by Arkhipov~\cite{arkhipov:2012}. Finally, Section~\ref{sec:conc} concludes this report.

\paragraph{Code.} The implementation of the classical and quantum
solutions to the magic square game can be found at
\url{https://github.com/luigidcsoares/quantum-magic-square}.

\section{The Magic Square Game}
\label{sec:magic-square}

A magic square is a \(3 \times 3\) matrix whose entries are filled
with \(\pm 1\)'s. The product of every row of a magic square must be
\(+1\). Similarly, the product of every column of a magic square must
be \(-1\). It is impossible to satisfy these two properties at the same
time, hence the term \emph{magic}: such a matrix cannot exist. The
magic square game features two players, Alice and Bob, that must work
together to fill in entries of the \(3 \times 3\) table.  At the
beginning of the game, Alice and Bob are separated by a referee,
Charlie, so that communication between them is impossible. At each
round, Charlie assigns one row of the matrix at random to Alice, and
asks Alice to give him the entries to fill in that particular
row. After that, Charlie visits Bob and asks him to fill one column of
the table, which Charlie draws at random.  Bob does not know which row
Alice was assigned, and Alice does not know which colum Bob was
assigned. Alice and Bob win the round if their answers are valid,
i.e.\ the product of the row filled by Alice is \(+1\) and the product
of the column filled by Bob is \(-1\), and, in addition, the
intersection of the row and the column agrees (i.e. both answered
\(+1\) or both answered \(-1\)). Before the game starts, Alice and Bob
are allowed to communicate, so they can come up with an strategy.  For
example, they may prepare their answers for each row and column
beforehand, or they may decide to follow a probabilistic strategy.

\subsection{Classical Solution}
\label{sec:classic-sol}
Assume that Alice and Bob decided to adopt a deterministic strategy.
For that, they met before the beginning of the game, and prepared
their answers for each possible row and column. In this scenario,
what is the best strategy that they can come up with?

\begin{tcbexample}{Classical, Deterministic Solution}{classic-sol}
  Alice and Bob might have agreed that, if given the first column, Bob shall fill it
  with three \(-1\)'s. Then, whatever row Alice is given, she must fill
  it with either \(\{-1, +1, -1\}\) or \(\{-1, -1, +1\}\). Suppose that
  Alice decided that she would fill any row in the same way:
  \(\{-1, -1, +1\}\). Figure~\ref{fig:classical} (a) shows how the
  predefined matrix would look like. Notice that Alice's rows are
  already defined, but Bob still has to decide how to fill the second
  and third columns. He can, and must, fill the second column with three
  \(-1\)'s, so that whatever row Alice is given, the intersection
  agrees. Intuitively, for the same reason, he should then fill the
  third column with three \(+1\)'s. However, this is not a valid
  strategy, since the product of the last column will be \(+1\) and not
  \(-1\), as required. Thus, Bob must fill at least one of the
  entries of the last column with \(-1\).  By doing that, there will be
  one row and column whose intersection does not agree, and thus one row
  and column for which Alice and Bob lose, as illustrated in
  Figure~\ref{fig:classical} (b).

  {\renewcommand{\arraystretch}{2}
    \begin{figure}[H]
      \centering
      \begin{subfigure}[t]{0.475\textwidth}
        \[\begin{array}{|>{\quad\columncolor{gray!50}}c<{\quad}|*{2}{>{\quad}c<{\quad}|}}
            \hhline{---}
            -1 & -1 & +1 
            \\ \hhline{---}
            -1 & -1 & +1 
            \\ \hhline{---}
            -1 & -1 & +1 
            \\ \hhline{---}
          \end{array}\]
        \caption{Initially, Alice and Bob agree that Bob shall fill the
          first column with \(\{-1, -1, -1\}\). Based on this choice,
          Alice decides to fill all of her rows with
          \(\{-1, -1, +1\}\).}
      \end{subfigure}
      \hfill{}
      \begin{subfigure}[t]{0.475\textwidth}
        \[\begin{array}{|*{3}{>{\quad\columncolor{gray!50}}c<{\quad}|}}
            \hhline{---}
            -1 & -1 & \cellcolor{red!80!black!55}\pm 1
            \\ \hhline{---}
            -1 & -1 & +1
            \\ \hhline{---}
            -1 & -1 & +1
            \\ \hhline{---}
          \end{array}\]
        \caption{Bob has to fill the second column with \(-1\)'s, to match
          Alice's choice. He should also match Alice's choice for each
          cell of the third column, but he cannot, for the product of
          the column must be \(-1\).}
      \end{subfigure}
      \caption{One possible classical deterministic strategy for the magic
        square game. Following this predefined strategy, Alice and Bob
        lose when assigned, respectively, the first row and third column,
        but win in any other scenario. That is, their probability of
        winning a round is \(\nicefrac{8}{9}\). Gray cells are entries for
        which Alice's and Bob's choices agree.\label{fig:classical}}
    \end{figure}}
\end{tcbexample}

Example~\ref{ex:classic-sol} illustrates one of the many deterministic
strategies that Alice and Bob can adopt. It is not difficult to
convince yourself that, no matter how they decide to fill in their
entries, it is impossible for them to come up with predefined answers
that always win. Any deterministic strategy is a pair of matrices, one
for Alice and another for Bob. The only way that they could design a
strategy that wins with certainty every round is to prepare two
identical matrices satisfying the requirements for each row and for
each column. That is, a single matrix for which the product of every
row is \(+1\) and the product of every column is \(-1\). Such a matrix
cannot possibly exist!  To see that, consider the constraints over
each row and column:
\[\begin{aligned}
    m_{0,0}\, m_{0,1}\, m_{0,2} &= +1 \\
    m_{1,0}\, m_{1,1}\, m_{1,2} &= +1 \\
    m_{2,0}\, m_{2,1}\, m_{2,2} &= +1 \\
    m_{0,0}\, m_{1,0}\, m_{2,0} &= -1 \\
    m_{0,1}\, m_{1,1}\, m_{2,1} &= -1 \\
    m_{0,2}\, m_{1,2}\, m_{2,2} &= -1 \\
    \midrule
    +1 &\neq -1
  \end{aligned}\]

It turns out that the best that they can do is to win
with probability \(\nicefrac{8}{9}\).

What if Alice and Bob decide for a probabilistic strategy? That is, Alice and
Bob each carry a coin. When assigned a row/column, they flip their
coins and fill the entries of the row/column based on the outcomes of
the coins. Can they do better? To randomly assign values to one row
(equivalently, one column) is essentially the same as randomly
selecting one of the \(2^{9}\) possible predefined \(3 \times 3\)
grids (including those matrices that would lead to invalid
answers). In other words, a probabilistic strategy for the magic
square game is one in which Alice and Bob randomly select a
deterministic strategy. Hence, no matter how lucky Alice and Bob are,
the probability of success of any strategy that they come up with is
bounded by the winning probability of the best deterministic strategy,
which is \(\nicefrac{8}{9}\). A formal proof is given in~\cite{brassard:2005}
for any pseudo-telepathy game (i.e.\ games whose quantum strategies
exhibit this notion of pseudo-telapathy).

\subsection{Quantum Solution}
\label{sec:quantum-sol}
The quantum strategy for the magic square game consists of Alice and
Bob carrying entangled qubits with them. Then, when Charlie asks Alice
(respectively Bob) to fill the entries of the \(i\)-th row
(respectively \(j\)-th column), Alice measures her two qubits three
times. The outcome of each measurement gives the value for each cell
(in practice, they do not even need the third measurement, since they
can determine the third value from the first two). Key to this
strategy is that the outcomes of all possible measurements are
\(\pm 1\). The initial, entangled state is (subscripts \(A\) and \(B\)
indicate, respectively, Alice's and Bob's qubits)
\begin{equation*}
  \ket{\psi} = \frac{1}{2}\left(
    \ket{00}_{A} \otimes \ket{00}_{B} + \ket{01}_{A} \otimes \ket{01}_{B} +
    \ket{10}_{A} \otimes \ket{10}_{B} + \ket{11}_{A} \otimes \ket{11}_{B}
  \right).
\end{equation*}
Figure~\ref{fig:circuit-psi} shows the quantum circuit that can be
used to prepare the initial state \(\ket{\psi}\).

\begin{figure}[htbp]
  \centering
  \begin{quantikz}
    \lstick{\ket{0}} & \gate{H}
    \slice[label style={xshift=-15mm}]
    {\(\frac{1}{2}(\ket{00} + \ket{01} + \ket{10} +
      \ket{11}) \otimes \ket{00}\)}
    &&&&& \ctrl{2} &&
    \\
    \lstick{\ket{0}} & \gate{H} &&&&&& \ctrl{2} & \\
    \lstick{\ket{0}} & &&&&& \targ{} && \\
    \lstick{\ket{0}} & &&&&&& \targ{}
    \slice[label style={xshift=5mm}]
    {\(\frac{1}{2}(\ket{0000} + \ket{0101} + \ket{1010} +
      \ket{1111})\)}
    &
  \end{quantikz}
  \caption{Quantum circuit for preparing the initial joint state
    of Alice and Bob.\label{fig:circuit-psi}}
\end{figure}

As seen in Section~\ref{sec:classic-sol}, the \emph{magic} square is
called this way because, under classical assumptions, there is no such
a square: it is impossible to construct a \(3 \times 3\) matrix filled
with \(\pm 1\)'s, with the constraints that the product of every row
is \(+1\) and the product of every column is \(-1\). We can, however,
construct a ``quantum magic'' square. Figure~\ref{fig:quantum} shows
the \(3 \times 3\) grid that Alice and Bob can use to win the magic
square game systematically.  Notice that the eigenvalues of the
observables at each cell are \(\pm 1\). Furthermore, the product of
every row is \(+I\) and the product of every column is \(-I\).  The
quantum strategy works as follows: Alice measures all the observables
from the \(i\)-th row of the predefined matrix. She fills each cell
with the result of each measurement. Similarly, Bob measures all the
observables in the \(j\)-th column that was assigned to him, and fills
each of his cells with the outcomes of each measurement. (It is worth
to point out that the order of their measurements is not important.)
Example~\ref{ex:quantum-sol} depicts a round of the game.

{\renewcommand{\arraystretch}{2}
\begin{figure}[htbp] 
  \centering
  \[\begin{array}{|*{3}{>{\quad}c<{\quad}|}>{\quad}l<{\quad}}
      \hhline{---~}
      +I \otimes Z & +Z \otimes I & +Z \otimes Z & \prod = I \otimes I = I
      \\ \hhline{---~}
      +X \otimes I & +I \otimes X & +X \otimes X & \prod = I \otimes I = I
      \\ \hhline{---~}
      -X \otimes Z & -Z \otimes X & +Y \otimes Y & \prod = \ci{}I \otimes -\ci{}I = I
      \\ \hhline{---~}
      \multicolumn{1}{>{\quad}c<{\quad}}{\prod = -I \otimes I = -I}
      & \multicolumn{1}{>{\quad}c<{\quad}}{\prod = -I \otimes I = -I}
      & \multicolumn{1}{>{\quad}c<{\quad}}{\prod = -\ci{}I \otimes -\ci{}I = -I}
    \end{array}\]
  \caption{Observables used by Alice and Bob to win the magic square game.\label{fig:quantum}}
\end{figure}}

\begin{tcbexample}{Quantum Solution}{quantum-sol}
  Suppose that Charlie assigns the first row to Alice. To decide the
  value of the first cell, she (based on the \(3 \times 3\) grid she
  and Bob have prepared) measures the observable \(I \otimes Z\)
  on her two qubits. The possible outcomes are
  \begin{equation}
    \operatorname{Out}((I \otimes Z)_{A} \otimes (I \otimes I)_{B}) =
    \begin{cases}
      +1 \left(I \otimes \ketbra{0}{0} \otimes I \otimes I\right)
        &\text{with probability } \frac{1}{2} \\
      -1 \left(I \otimes \ketbra{1}{1} \otimes I \otimes I\right)
        &\text{with probability } \frac{1}{2},
    \end{cases}
  \end{equation}
  Suppose that Alice has observed \(+1\). In this case, the initial
  state \(\ket{\psi}\) collapses to
  \begin{equation}
    \ket{\psi}_{A0} =  \frac{1}{\sqrt{2}}(\ket{0000} + \ket{1010}),
  \end{equation}
  where the subscript \(A0\) denotes the state after Alice's first
  measurement.  For the second cell, Alice measures the observable
  \(Z \otimes I\), whose possible outcomes are
  \begin{equation}
    \operatorname{Out}((Z \otimes I)_{A} \otimes (I \otimes I)_{B}) =
    \begin{cases}
      +1 \left(\ketbra{0}{0} \otimes I \otimes I \otimes I\right)
        &\text{with probability } \frac{1}{2} \\
      -1 \left(\ketbra{1}{1} \otimes I \otimes I \otimes I\right)
        &\text{with probability } \frac{1}{2}.
    \end{cases}
  \end{equation}
  Suppose, now, that Alice has observed the outcome \(-1\). The state
  collapses to
  \begin{equation}
    \ket{\psi}_{A1} =  \ket{1010}.
  \end{equation}
  Finally, Alice measures the observable \(Z \otimes Z\), whose
  possible outcomes are
  \begin{equation}
    \operatorname{Out}((Z \otimes Z)_{A} \otimes (I \otimes I)_{B}) =
    \begin{cases}
      +1 \left(\left(\ketbra{00}{00} + \ketbra{11}{11}\right) \otimes I \otimes I\right)
      &\text{with probability } 0 \\
      -1 \left(\left(\ketbra{01}{01} + \ketbra{10}{10}\right) \otimes I \otimes I\right)
      &\text{with probability } 1.
    \end{cases}
  \end{equation}
  Notice that the only possible outcome that Alice can observe is
  \(-1\), and the state does not change, i.e.
  \(\ket{\psi}_{A2} = \ket{\psi}_{A1}\).  Alice, then, fills the first
  row with the values \(\{+1, -1, -1\}\), whose product is, as
  required
  , \(+1\). Upon receiving Alice's answer, Charlie goes to
  meet Bob. Suppose he assigns the second column to Bob. To fill in
  the value of the first cell (which is the intersection of the first
  row and second column), Bob measures the observable \(Z \otimes
  I\). The only possible outcome, considering the state
  \(\ket{\psi}_{A2}\), is \(-1\) ---~which matches Alice's answer~---
  and the state will not change again:
  \(\ket{\psi}_{B0} = \ket{\psi}_{A2}\). Moving on to the second cell,
  Bob measures the observable \(I \otimes X\), whose possible outcomes
  are
  \begin{equation}
    \operatorname{Out}((I \otimes I)_{A} \otimes (I \otimes X)_{B}) =
    \begin{cases}
      +1 \left(I \otimes I \otimes I \otimes \ketbra{+}{+}\right)
      &\text{with probability } \frac{1}{2} \\
      -1 \left(I \otimes I \otimes I \otimes \ketbra{-}{-}\right)
      &\text{with probability } \frac{1}{2}.
    \end{cases}
  \end{equation}
  Assume that Bob has observed the outcome \(+1\). Then, the state
  collapses to
  \begin{equation}
    \ket{\psi}_{B1} =  \frac{1}{\sqrt{2}}(\ket{1010} + \ket{1011}).
  \end{equation}
  Finally, Bob measures \(-Z \otimes X\) on his two qubits.
  The possible outcomes are
  \begin{equation}
    \operatorname{Out}((I \otimes I)_{A} \otimes (-Z \otimes X)_{B}) =
    \begin{cases}
      +1 \left(I \otimes I \otimes \left(\ketbra{1+}{1\!+\!} + \ketbra{0-}{0\!-\!}\right)\right)
      &\text{with prob. } 1 \\
      -1 \left(I \otimes I \otimes \left(\ketbra{1-}{1\!-\!} + \ketbra{0+}{0\!+\!}\right)\right)
      &\text{with prob. } 0.
    \end{cases}
  \end{equation}
  Bob will for sure observe the outcome \(+1\) and the state does not
 change, i.e.  \(\ket{\psi}_{B2} = \ket{\psi}_{B1}\). Therefore, Bob
  answers \(\{-1, +1, +1\}\). Alice's answer satisfies the property of
  the rows (that the product of the entries is equal to \(+1\)) and
  Bob's answer satisfies the property of the columns (product is equal
  to \(-1\)).  Moreover, Alice and Bob agreed in the intersection of
  the row and the column.  Hence, they won this round!
\end{tcbexample}

\subsection{Formal Proof}\label{sec:msquare-proof}
To prove that the quantum solution indeed works, we must demonstrate
two fundamental properties. First, the product of the outcomes of the
three measurements on each row (equivalently, column) is equal to 1
(equivalently, -1). Second, the outcome of Alice's measurement on the
intersection is always equal to the outcome of
Bob's. Lemma~\ref{lem:product} formalizes the product property.

\begin{lemma}[The Product Property of the Quantum Solution]
  \label{lem:product}
  Let \(M_{i, j}\) be the observable at the cell \((i, j)\) of the
  \(3 \times 3\) grid shown in Figure~\ref{fig:quantum}. Then,
  it follows that

  \begin{align}
    \textit{for every }i, \prod_{j} \operatorname{Out}(M_{i, j}) &= +1  \textit{, and} \\
    \textit{for every }j, \prod_{i} \operatorname{Out}(M_{i, j}) &= -1.
  \end{align}
\end{lemma}

\begin{proof}
  \label{proof:product}
  First, notice that \(X^{2} = Z^{2} = Y^{2} = I\), \(XZ = \ci{}Y\)
  and \(ZX = -\ci{}Y\) (i.e. \(X\) and \(Z\) anticommute), and,
  similarly, \(XY = \ci{}Z\) and \(YX = -\ci{}Z\). Using these
  properties, we can see that the product of every row (equiv. column)
  is the identity \(I\) (equiv. \(-I\)), regardless of the order of
  the three observables.  That is, the three observables of every row
  and every column mutually commute (or, in other words, they are
  compatible).  Consequently, for every row and every column, it is
  possible to find a basis of eigenvectors that are common to the
  three observables, meaning that they can be diagonalized
  simultaneously. Tables~\ref{tab:eigenv-rows} and \ref{tab:eigenv-cols} show
  these common eigenvectors. Let \(M_{i, j}\) be the observables at
  each cell.  Then, for every row \(i\) (equiv. column \(j\)), we have
  \begin{align}
    M_{i, 0} M_{i, 1} M_{i, 2}
    &= (P_{i} \Lambda_{i, 0} P_{i}^{-1}) (P_{i}\Lambda_{i, 1}P_{i}^{-1}) (P_{i}\Lambda_{i, 2}P_{i}^{-1})
      \nonumber \\
    &= P_{i}(\Lambda_{i, 0} \Lambda_{i, 1} \Lambda_{i, 2})P_{i}^{-1} \nonumber \\
    &= P_{i}\Lambda_{i}P_{i}^{-1},
  \end{align}
  where \(P_{i}\) is the matrix whose columns are the common
  eigenvectors and \(\Lambda_{i}\) is the matrix whose diagonal is
  formed by the products of the eigenvalues of the observables,
  associated with the same eigenvector. What this essentially means is
  that any measurement \(M_{i, j}\) yields one of the eigenvalues
  \(\lambda\) in the diagonal of \(\Lambda_{i, j}\) and projects the
  state onto the \(\lambda\)-eigenspace. That is, it collapses the
  state to a linear combination of the two shared eigenvectors
  \(\ket{\lambda}_{0}\) and \(\ket{\lambda}_{1}\) in the
  \(\lambda\)-eigenspace. Then, the second measurement will collapse
  the state to either \(\ket{\lambda}_{0}\) or \(\ket{\lambda}_{1}\),
  eigenvectors common to the three observables.  Consequently, the
  third measurement will not change the state any further. Therefore,
  the product of the three outcomes will be the product of the
  eigenvalues associated with either \(\ket{\lambda}_{0}\) or
  \(\ket{\lambda}_{1}\), which is one of the entries in the diagonal
  of \(\Lambda_{i}\). But, notice that
  \(P_{i}\Lambda_{i}P_{i}^{-1} = I\); thus, \(\Lambda_{i} = I\) and
  the only possible value for the product is \(1\) (equivalently,
  \(-1\) for columns). \qed
\end{proof}

\begin{table}[t]
  \centering
  \caption{Eigenvectors shared by the observables at each row of the quantum magic square.
    The eigenvectors were taken from~\cite{breinig:online}, adapting to the correct eigenvalues.}
  \label{tab:eigenv-rows}
  \begin{tabular}{c*{4}{>{\;\;}c}}
    \toprule
    & & Column 0 & Column 1 & Column 2 \\
    \midrule
    \multirow{2}{*}{Row 0} & \(+1\)
      & \ket{00}, \ket{10} & \ket{00}, \ket{01} & \ket{00}, \ket{11} \\
    & \(-1\)
      & \ket{01}, \ket{11} & \ket{10}, \ket{11} & \ket{01}, \ket{10} \\
    \midrule
    \multirow{4}{*}{Row 1} & \multirow{2}{*}{\(+1\)}
      & \((\nicefrac{1}{2}) (\ket{00} + \ket{01} + \ket{10} + \ket{11})\),
                 & \((\nicefrac{1}{2}) (\ket{00} + \ket{01} + \ket{10} + \ket{11})\),
                            & \((\nicefrac{1}{2}) (\ket{00} + \ket{01} + \ket{10} + \ket{11})\), \\ 
    & & \((\nicefrac{1}{2}) (\ket{00} - \ket{01} + \ket{10} - \ket{11})\)\phantom{,} 
                 & \((\nicefrac{1}{2}) (\ket{00} + \ket{01} - \ket{10} - \ket{11})\)\phantom{,} 
                            & \((\nicefrac{1}{2}) (\ket{00} - \ket{01} - \ket{10} + \ket{11})\)\phantom{,} \\[1.5mm]
    & \multirow{2}{*}{\(-1\)}
      & \((\nicefrac{1}{2}) (\ket{00} - \ket{01} - \ket{10} + \ket{11})\),
                 & \((\nicefrac{1}{2}) (\ket{00} - \ket{01} - \ket{10} + \ket{11})\),
                            & \((\nicefrac{1}{2}) (\ket{00} + \ket{01} - \ket{10} - \ket{11})\), \\ 
    & & \((\nicefrac{1}{2}) (\ket{00} + \ket{01} - \ket{10} - \ket{11})\)\phantom{,} 
                 & \((\nicefrac{1}{2}) (\ket{00} - \ket{01} + \ket{10} - \ket{11})\)\phantom{,} 
                            & \((\nicefrac{1}{2}) (\ket{00} - \ket{01} + \ket{10} - \ket{11})\)\phantom{,} \\
    \midrule
    \multirow{4}{*}{Row 2} & \multirow{2}{*}{\(+1\)}
      & \((\nicefrac{1}{2}) (\ket{01} - \ket{00} + \ket{10} + \ket{11})\),
                 & \((\nicefrac{1}{2}) (\ket{01} - \ket{00} + \ket{10} + \ket{11})\),
                            & \((\nicefrac{1}{2}) (\ket{01} - \ket{00} + \ket{10} + \ket{11})\), \\ 
    & & \((\nicefrac{1}{2}) (\ket{00} + \ket{01} - \ket{10} + \ket{11})\),
                 & \((\nicefrac{1}{2}) (\ket{00} - \ket{01} + \ket{10} + \ket{11})\),
                            & \((\nicefrac{1}{2}) (\ket{00} + \ket{01} + \ket{10} - \ket{11})\), \\[1.5mm]
    & \multirow{2}{*}{\(-1\)}
      & \((\nicefrac{1}{2}) (\ket{00} - \ket{01} + \ket{10} + \ket{11})\),
                 & \((\nicefrac{1}{2}) (\ket{00} + \ket{01} - \ket{10} + \ket{11})\),
                            & \((\nicefrac{1}{2}) (\ket{00} + \ket{01} - \ket{10} + \ket{11})\), \\
    & & \((\nicefrac{1}{2}) (\ket{00} + \ket{01} + \ket{10} - \ket{11})\),
                 & \((\nicefrac{1}{2}) (\ket{00} + \ket{01} + \ket{10} - \ket{11})\),
                            & \((\nicefrac{1}{2}) (\ket{00} - \ket{01} + \ket{10} + \ket{11})\), \\
    \bottomrule
  \end{tabular}
\end{table}

\begin{table}[t]
  \centering
  \caption{Eigenvectors shared by the observables at each column of the quantum magic square.
    The eigenvectors were taken from~\cite{breinig:online}, adapting to the correct eigenvalues.}
  \label{tab:eigenv-cols}
  \begin{tabular}{c*{4}{>{\;\;}c}}
    \toprule
    & & Row 0 & Row 1 & Row 2 \\
    \midrule
    \multirow{4}{*}{Column 0} & \multirow{2}{*}{\(+1\)}
      & \((\nicefrac{1}{\sqrt{2}}) (\ket{00} + \ket{10})\),
      & \((\nicefrac{1}{\sqrt{2}}) (\ket{00} + \ket{10})\), 
      & \((\nicefrac{1}{\sqrt{2}}) (\ket{00} - \ket{10})\), \\
    & &  \((\nicefrac{1}{\sqrt{2}}) (\ket{00} - \ket{10})\)\phantom{,}
      & \((\nicefrac{1}{\sqrt{2}}) (\ket{01} + \ket{11})\)\phantom{,}
      & \((\nicefrac{1}{\sqrt{2}}) (\ket{01} + \ket{11})\)\phantom{,} \\[1.5mm]
    & \multirow{2}{*}{\(-1\)}
      & \((\nicefrac{1}{\sqrt{2}}) (\ket{01} + \ket{11})\), 
      & \((\nicefrac{1}{\sqrt{2}}) (\ket{00} - \ket{10})\), 
      & \((\nicefrac{1}{\sqrt{2}}) (\ket{00} + \ket{10})\), \\
    & & \((\nicefrac{1}{\sqrt{2}}) (\ket{01} - \ket{11})\)\phantom{,}
      & \((\nicefrac{1}{\sqrt{2}}) (\ket{01} - \ket{11})\)\phantom{,}
      & \((\nicefrac{1}{\sqrt{2}}) (\ket{01} - \ket{11})\)\phantom{,} \\
    \midrule
    \multirow{4}{*}{Column 1} & \multirow{2}{*}{\(+1\)}
      & \((\nicefrac{1}{\sqrt{2}}) (\ket{00} + \ket{01})\),
      & \((\nicefrac{1}{\sqrt{2}}) (\ket{00} + \ket{01})\), 
      & \((\nicefrac{1}{\sqrt{2}}) (\ket{00} - \ket{01})\), \\
    & &  \((\nicefrac{1}{\sqrt{2}}) (\ket{00} - \ket{01})\)\phantom{,}
      & \((\nicefrac{1}{\sqrt{2}}) (\ket{10} + \ket{11})\)\phantom{,}
      & \((\nicefrac{1}{\sqrt{2}}) (\ket{10} + \ket{11})\)\phantom{,} \\[1.5mm]
    & \multirow{2}{*}{\(-1\)}
      & \((\nicefrac{1}{\sqrt{2}}) (\ket{10} + \ket{11})\), 
      & \((\nicefrac{1}{\sqrt{2}}) (\ket{00} - \ket{01})\), 
      & \((\nicefrac{1}{\sqrt{2}}) (\ket{00} + \ket{01})\), \\
    & & \((\nicefrac{1}{\sqrt{2}}) (\ket{10} - \ket{11})\)\phantom{,}
      & \((\nicefrac{1}{\sqrt{2}}) (\ket{10} - \ket{11})\)\phantom{,}
      & \((\nicefrac{1}{\sqrt{2}}) (\ket{10} - \ket{11})\)\phantom{,} \\
    \midrule
        \multirow{4}{*}{Column 2} & \multirow{2}{*}{\(+1\)}
      & \((\nicefrac{1}{\sqrt{2}}) (\ket{00} + \ket{11})\),
      & \((\nicefrac{1}{\sqrt{2}}) (\ket{00} + \ket{11})\), 
      & \((\nicefrac{1}{\sqrt{2}}) (\ket{01} + \ket{10})\), \\
    & &  \((\nicefrac{1}{\sqrt{2}}) (\ket{00} - \ket{11})\)\phantom{,}
      & \((\nicefrac{1}{\sqrt{2}}) (\ket{01} + \ket{10})\)\phantom{,}
      & \((\nicefrac{1}{\sqrt{2}}) (\ket{00} - \ket{11})\)\phantom{,} \\[1.5mm]
    & \multirow{2}{*}{\(-1\)}
      & \((\nicefrac{1}{\sqrt{2}}) (\ket{01} + \ket{10})\), 
      & \((\nicefrac{1}{\sqrt{2}}) (\ket{00} - \ket{11})\), 
      & \((\nicefrac{1}{\sqrt{2}}) (\ket{00} + \ket{11})\), \\
    & & \((\nicefrac{1}{\sqrt{2}}) (\ket{01} - \ket{10})\)\phantom{,}
      & \((\nicefrac{1}{\sqrt{2}}) (\ket{01} - \ket{10})\)\phantom{,}
      & \((\nicefrac{1}{\sqrt{2}}) (\ket{01} - \ket{10})\)\phantom{,} \\
    \bottomrule
  \end{tabular}
\end{table}

Lemma~\ref{lem:product} shows that the quantum solution satisfies the
requirements of the game for every row and column. Now, we move on to
show that Alice and Bob always agree in the value that they assign
to the intersection of the row and column.

\begin{lemma}[The Intersection Property of the Quantum Solution]
  \label{lem:intersection}
  For any row \(i\) assigned to Alice and column \(j\) assigned to
  Bob, the value ascribed to the cell \((i, j)\) by Alice and Bob,
  after they have performed their measurements, is always the same.
\end{lemma}

\begin{proof}
  To prove that Alice and Bob agree at the intersection, it suffices
  to look to the eigenvectors shared by each set of mutually commuting
  operators, shown in Tables~\ref{tab:eigenv-rows} and
  \ref{tab:eigenv-cols}.  Notice that, regardless of the row assigned
  to Alice, the state of her subsystem after her measurements is
  always one of the eigenvectors in that row. This state is always a
  linear combination of one of Bob's eigenspaces for the cell in the
  intersection (the same applies if we consider first Bob than Alice).
  Take, for instance, the second row and first column. Suppose that
  Alice's measurements collapsed her qubits to
  \((\nicefrac{1}{2}) (\ket{00} - \ket{01} - \ket{10} + \ket{11})\).
  This state can be written as
  \((\nicefrac{1}{\sqrt{2}}) (\ket{00} - \ket{10}) -
  (\nicefrac{1}{\sqrt{2}}) (\ket{01} - \ket{11})\), a linear
  combination of the \(-1\)-eigenspace depicted in
  Table~\ref{tab:eigenv-cols} (column 0, row 1).  What is left is to
  show that Bob's state will be exactly the same as Alice's, implying
  that Bob shall observe the same result. This follows from the fact
  that the initial state is already symmetric (the first qubit of
  Alice is equal to the first qubit of Bob; the same is true for their
  second qubits) and the symmetry is preserved by any measurement
  performed by Alice and Bob. For the first row, this is easy to see.
  The others are trickier, but it all boils down to doing the
  calculations.  Consider, for instance, the second row, and suppose
  that the outcomes were \(-1\), \(-1\) and \(+1\), so that Alice's
  state collapsed to
  \((\nicefrac{1}{2}) (\ket{00} - \ket{01} - \ket{10} +
  \ket{11})\). The complete state after the first measurement is
  \begin{align}
    &\frac{1}{2\sqrt{2}} \Bigl(
    (\ket{00} - \ket{10}) \ket{00} +
    (\ket{01} - \ket{11}) \ket{01} +
    (\ket{10} - \ket{00}) \ket{10} +
    (\ket{11} - \ket{01}) \ket{11}
    \Bigr) \nonumber \\
    \equiv\;
    & \frac{1}{2\sqrt{2}} \Bigl(
      \ket{00} (\ket{00} - \ket{10}) +
      \ket{01} (\ket{01} - \ket{11}) +
      \ket{10} (\ket{10} - \ket{00}) +
      \ket{11} (\ket{11} - \ket{01})
    \Bigr).
  \end{align}
  And, the state after the second measurement is
  \begin{alignat}{2}
    &\frac{1}{4} \Bigl(
      &&(\ket{00} - \ket{01} - \ket{10} + \ket{11}) \ket{00} -
        (\ket{00} - \ket{01} - \ket{10} + \ket{11}) \ket{01} - \nonumber \\
    & &&(\ket{00} - \ket{01} - \ket{10} + \ket{11}) \ket{10} +
      (\ket{00} - \ket{01} - \ket{10} + \ket{11}) \ket{11}
    \Bigr) \nonumber \\
    \equiv\;
    & \frac{1}{4} \Bigl(
      &&\ket{00} (\ket{00} - \ket{01} - \ket{10} + \ket{11}) -
        \ket{01} (\ket{00} - \ket{01} - \ket{10} + \ket{11}) - \nonumber \\
    & &&\ket{10} (\ket{00} - \ket{01} - \ket{10} + \ket{11}) +
         \ket{11} (\ket{00} - \ket{01} - \ket{10} + \ket{11})
         \Bigr).
  \end{alignat}
  The calculations for the other rows and columns are similar, so we omitted them.
  \qed

  With Lemmas~\ref{lem:product} and~\ref{lem:intersection}, we can prove
  Theorem~\ref{theo:quantum-wins}, which states that there is a quantum strategy
  for the Mermin-Peres magic square game that always win.

  \begin{theorem}[The Mermin-Peres Magic Square Game Is Winnable]
    \label{theo:quantum-wins}
    There exists a quantum strategy for the Mermin-Peres magic square
    game, which consists of allowing Alice and Bob to exchange
    entangled qubits \emph{before} the game begins, that wins with
    certainty every round.
  \end{theorem}
\end{proof}

\subsection{Implementing with Circuits}
In this section, we show the circuits used to implement the quantum
strategy. We implemented the solution using the \texttt{Qiskit}
library. \texttt{Qiskit} only allows measurements in the computational
basis. For any other basis \(B\), we must find an unitary
transformation \(U\) such that \(B = U^{*} (Z \otimes I) U\) or
\(B = U^{*} (I \otimes Z) U\) (where \(U^{*}\) denotes the Hermitian
adjoint of \(U\)). For example,
\begin{equation}
  Z \otimes Z = \cnot{} (I \otimes Z) \cnot{}
\end{equation}
and
\begin{equation}
  X \otimes X = (H \otimes H) (Z \otimes Z) (H \otimes H).
\end{equation}
Figure~\ref{fig:change-basis} shows the unitaries for each of
the nine observables.

{\renewcommand{\arraystretch}{2}
  \begin{figure}
    \centering
    \[\begin{array}{|*{2}{>{\quad}c<{\quad}|}>{\quad}l<{\quad}|}
        \hhline{---}
        (I \otimes I) (I \otimes Z) (I \otimes I) & (I \otimes I) (Z \otimes I) (I \otimes I) & \cnot (I \otimes Z) \cnot
        \\ \hhline{---}
        (H \otimes I) (Z \otimes I) (H \otimes I) & (I \otimes H) (I \otimes Z) (I \otimes H) & (H \otimes H) (Z \otimes Z) (H \otimes H)
        \\ \hhline{---}
        (H \otimes Y) (Z \otimes Z) (H \otimes Y) & (Y \otimes H) (Z \otimes Z) (Y \otimes H) &
                                                                                                (S \otimes S) (X \otimes X) (S^{*} \otimes S^{*}) 
        \\ \hhline{---}
      \end{array}\]
    \caption{Unitary transformations required for measuring in
      different bases. The actual basis measured is the middle
      term of each cell, which, after expanding, is either
      \(Z \otimes I\) or \(I \otimes Z\). For example, in the last
      cell, \(X \otimes X\) evaluates to
      \((H \otimes H) (Z \otimes Z) (H \otimes H)\).
      \(Z \otimes Z\), in turn, becomes \(\cnot (I \otimes Z) \cnot\), meaning that
      we measure the second qubit in the computational basis.\label{fig:change-basis}}
  \end{figure}}

We now show the quantum circuits for each row and each column:

\begin{description}
\item[Row 0:] When assigned the first row, Alice performs the measurements
  \(I \otimes Z, Z \otimes I\) and \(Z \otimes Z\), which the circuit
  in Figure~\ref{fig:circ-row0} implements.

  \begin{figure}[H]
    \centering
    \begin{quantikz}
      \lstick{\(A_{0}\)}
      & \metercw[label style={inner sep=1pt}]{a_{1}}
      & \ctrl{1}
      &
      & \ctrl{1}
      &
      \\
      \lstick{\(A_{1}\)}
      & \metercw[label style={inner sep=1pt}]{a_{0}}
      & \targ{}
      & \metercw[label style={inner sep=1pt}]{a_{2}}
      & \targ{}
      &
    \end{quantikz}
    \caption{Quantum circuit for measuring the first row.\label{fig:circ-row0}}
  \end{figure}

\item[Row 1:] When assigned the second row, Alice performs the measurements
  \(X \otimes I, I \otimes X\) and \(X \otimes X\), which the circuit
  in Figure~\ref{fig:circ-row1} implements.

  \begin{figure}[H]
    \centering
    \begin{quantikz}
      \lstick{\(A_{0}\)}
      & \gate{H}
      & \metercw[label style={inner sep=1pt}]{a_{0}}
      & \ctrl{1}
      &
      & \ctrl{1}
      & \gate{H}
      &
      \\
      \lstick{\(A_{1}\)}
      & \gate{H}
      & \metercw[label style={inner sep=1pt}]{a_{1}}
      & \targ{}
      &  \metercw[label style={inner sep=1pt}]{a_{2}}
      & \targ{}
      & \gate{H}
      &
    \end{quantikz}
    \caption{Quantum circuit for measuring the second row.\label{fig:circ-row1}}
  \end{figure}

\item[Row 2:] When assigned the third row, Alice performs the measurements
  \(-X \otimes Z, -Z \otimes X\) and \(Y \otimes Y\), which the circuit
  in Figure~\ref{fig:circ-row2} implements.

  \begin{figure}[H]
    \centering
    \begin{quantikz}[column sep=0.25cm]
      \lstick{\(A_{0}\)}
      & \gate{H}
      & \ctrl{1}
      &
      & \ctrl{1}
      & \gate{H}
      & \gate{Y}
      & \ctrl{1}
      &
      & \ctrl{1}
      & \gate{Y}
      & \gate{S}
      & \gate{H}
      & \ctrl{1}
      &
      & \ctrl{1}
      & \gate{H}
      & \gate{S^*}
      \\
      \lstick{\(A_{1}\)}
      & \gate{Y}
      & \targ{}
      & \metercw[label style={inner sep=1pt}]{a_{0}}
      & \targ{}
      & \gate{Y}
      & \gate{H}
      & \targ{}
      & \metercw[label style={inner sep=1pt}]{a_{1}}
      & \targ{}
      & \gate{H}
      & \gate{S}
      & \gate{H}
      & \targ{}
      & \metercw[label style={inner sep=1pt}]{a_{2}}
      & \targ{}
      & \gate{H}
      & \gate{S^*}
    \end{quantikz}
    \caption{Quantum circuit for measuring the third row.\label{fig:circ-row2}}
  \end{figure}

\item[Column 0:] When assigned the first column, Bob performs the measurements
  \(I \otimes Z, X \otimes I\) and \(-X \otimes Z\), which the circuit
  in Figure~\ref{fig:circ-col0} implements.

  \begin{figure}[H]
    \centering
    \begin{quantikz}
      \lstick{\(B_{0}\)}
      & \gate{H}
      & \metercw[label style={inner sep=1pt}]{b_{1}}
      &
      & \ctrl{1}
      &
      & \ctrl{1}
      & \gate{H}
      &
      \\
      \lstick{\(B_{1}\)}
      &
      & \metercw[label style={inner sep=1pt}]{b_{0}}
      & \gate{Y}
      & \targ{}
      & \metercw[label style={inner sep=1pt}]{b_{1}}
      & \targ{}
      & \gate{Y}
      &
    \end{quantikz}
    \caption{Quantum circuit for measuring the first column.\label{fig:circ-col0}}
  \end{figure}

\item[Column 1:] When assigned the second column, Bob performs the measurements
  \(Z \otimes I, I \otimes X\) and \(-Z \otimes X\), which the circuit
  in Figure~\ref{fig:circ-col1} implements.

  \begin{figure}[H]
    \centering
    \begin{quantikz}
      \lstick{\(B_{0}\)}
      & 
      & \metercw[label style={inner sep=1pt}]{b_{0}}
      & \gate{Y}
      & \ctrl{1}
      &
      & \ctrl{1}
      & \gate{Y}
      &
      \\
      \lstick{\(B_{1}\)}
      & \gate{H}
      & \metercw[label style={inner sep=1pt}]{b_{1}}
      & 
      & \targ{}
      & \metercw[label style={inner sep=1pt}]{b_{2}}
      & \targ{}
      & \gate{H}
      &
    \end{quantikz}
    \caption{Quantum circuit for measuring the second column.\label{fig:circ-col1}}
  \end{figure}

\item[Column 2:] When assigned the third column, Bob performs the measurements
  \(Z \otimes Z, X \otimes X\) and \(Y \otimes X\), which the circuit
  in Figure~\ref{fig:circ-col2} implements.

  \begin{figure}[H]
    \centering
    \begin{quantikz}[column sep=0.25cm]
      \lstick{\(B_{0}\)}
      & \ctrl{1}
      &
      & \ctrl{1}
      & \gate{H}
      & \ctrl{1}
      &
      & \ctrl{1}
      & \gate{H}
      & \gate{S}
      & \gate{H}
      & \ctrl{1}
      &
      & \ctrl{1}
      & \gate{H}
      & \gate{S^*}
      &
      \\
      \lstick{\(B_{1}\)}
      & \targ{}
      & \metercw[label style={inner sep=1pt}]{b_{0}}
      & \targ{}
      & \gate{H}
      & \targ{}
      & \metercw[label style={inner sep=1pt}]{b_{1}}
      & \targ{}
      & \gate{H}
      & \gate{S}
      & \gate{H}
      & \targ{}
      & \metercw[label style={inner sep=1pt}]{b_{2}}
      & \targ{}
      & \gate{H}
      & \gate{S^*}
      &
    \end{quantikz}
    \caption{Quantum circuit for measuring the third column.\label{fig:circ-col2}}
  \end{figure}
\end{description}

\subsection{A Note on Compatible Observables}
\label{sec:sim-meas}

As seen in Section~\ref{sec:msquare-proof}, the operators on each
row and column are compatible. That is, for any row and any column,
the observables pairwise commute. This means that they can be
simultaneously diagonalized by the same eigenvectors. It turns out
that the simultaneous measurement of compatible operators is
equivalent to the measurement of a single nondegenerate
operator~\cite{peres:1997}. That is, instead of performing three
measurements, one for each cell, Alice and Bob could perform a single
measurement each, whose answers would tell them to which of the four
common eigenvectors their qubits would have collapsed to, had they
performed the individual measurements. Based on this, they could fill
each cell with the eigenvalue that corresponds to that eigenvector. To
construct these single measurements for each row and column, it
suffices to take the projectors onto the eigenvectors shared by the
observables. Example~\ref{ex:sim-meas} further illustrates this idea.

\begin{tcbexample}{Simultaneous Measurement}{sim-meas}
  Consider, for instance, the first row of the quantum solution for
  the magic square game, depicted in Figure~\ref{fig:quantum}. The
  observables in this row are \(I \otimes Z\), \(Z \otimes I\), and
  \(Z \otimes Z\). The eigenvectors common to these operators are
  \ket{00}, \ket{01}, \ket{10}, and \ket{11}. Alice, then, could
  simply construct an observable
  \[M = \ketbra{00}{00} + 2 \ketbra{01}{01} + 3 \ketbra{10}{10} + 4
    \ketbra{11}{11},\] which corresponds to the diagonal matrix
  \begin{equation*}
    M = \begin{pmatrix}
          1 & 0 & 0 & 0 \\
          0 & 2 & 0 & 0 \\
          0 & 0 & 3 & 0 \\
          0 & 0 & 0 & 4
    \end{pmatrix}.
  \end{equation*}
  By measuring \(M\) on her qubits, she would observe (with
  probability \(\nicefrac{1}{4}\)) the outcomes \(1\), \(2\), \(3\), or
  \(4\), which uniquely identifies one of the four eigenvectors
  \ket{00}, \ket{01}, \ket{10}, or \ket{11}. Consequently, she would
  know the eigenvalues associated with the eigenvector ``observed'',
  and would be able to correctly fill the cells of the first row. For
  example, outcome \(3\) corresponds to \ket{10}. Hence, if she
  observes \(3\), she fills the first row with \(\{+1, -1, -1\}\).
\end{tcbexample}

\subsection{A Proof of The Kochen-Specker Theorem}
\label{sec:context}

The Kochen-Specker theorem~\cite{kochen:1967} demonstrates
the incompatilibty between an interpretation of quantum mechanics
that is both deterministic ---~in the sense that there exists
hidden variables that we do not have access to, and thus
the stochasticity that we observe is merely epistemic~--- and,
at the same time, noncontextual. Noncontextuality means that
the outcomes of a measurement do not depend on the context,
where a context is a set of compatible observables.

Consider the magic square game described above. In a noncontextual
hidden-variable model, we should be able to ascribe pre-determined
outcomes to the nine observables in each cell. That is, for each
observable \(M_{i, j}\) in a cell \((i, j)\), there should be an
assignment \(v(M_{i, j}) = \pm{}1\). However, as seen in
Section~\ref{sec:classic-sol}, this is impossible. Hence, either the
model must be contextual, meaning that the outcomes of the
measurements are influenced by the context in which they are inserted
---~for instance, pick any observable in the \(3 \times 3\) grid shown
in Figure~\ref{fig:quantum} and recall that it commutes with the other
two observables in the row and also in the column; then, the result of
measuring this observable is influenced by whether you are measuring
it in the row or in the column~---, or there cannot exist hidden
variables governing the values assigned to each observable.

\section{Characterizing Quantum Magic Games}
\label{sec:extending}
What if we change the format of the magic square game?  Maybe increase
the dimensions, or even change the shape entirely?
Figure~\ref{fig:as-graph} (a) gives an example of the magic pentagram
game, in which the product of the labels (\(\pm{}1\)) assigned to each
of four vertices in a line must equal the labels of that line (the
product of the four vertices in the topmost horizontal line, for
example, must be \(-1\)). Notice that we are now changing the
visualization format to hypergraphs.  Figure~\ref{fig:as-graph} (b)
shows the magic square as a hypergraph.  As the magic square, the
pentagram is also due to Mermin~\cite{mermin:1993}.  In this section,
we explore a characterization of Mermin-style games, given
by~\cite{arkhipov:2012}.

\begin{figure}[htbp]
  \centering
   \begin{subfigure}[t]{0.49\textwidth}
    \begin{center}
      \begin{tikzpicture}[vertex/.style={circle, thin, fill=blue!30, draw, inner sep=0, minimum size=5pt}]
        \foreach \c [evaluate=\c as \ang using {18 + 72*\c}] in {0, 1, 2, 3, 4} {
          \node [vertex] (\c) at (\ang:25mm) {};
        }

        \draw [name path=0--2] (0) -- (2);
        \draw [name path=0--3] (0) -- (3);
        \draw [name path=1--3] (1) -- (3);
        \draw [name path=1--4] (1) -- (4);
        \draw [name path=2--4] (2) -- (4);

        \node [vertex] (01) at (intersection of 0--2 and 1--4) {};
        \node [vertex] (04) at (intersection of 0--3 and 1--4) {};
        \node [vertex] (12) at (intersection of 1--3 and 0--2) {};
        \node [vertex] (23) at (intersection of 1--3 and 2--4) {};
        \node [vertex] (34) at (intersection of 0--3 and 2--4) {};
        
        \node [text=red!50!black!80] (label0--2) at ($(01)!0.5!(12) - (0, 0.25)$) {\(-1\)};
        \node [text=green!50!black!80] (label1--4) at ($(01)!0.5!(04) + (-0.3, -0.1)$) {\(+1\)};
        \node [text=green!50!black!80] (label0--3) at ($(04)!0.5!(34) + (-0.1, 0.25)$) {\(+1\)};
        \node [text=green!50!black!80] (label2--4) at ($(23)!0.5!(34) + (+0.1, 0.25)$) {\(+1\)};
        \node [text=green!50!black!80] (label1--3) at ($(12)!0.5!(23) + (+0.3, -0.1)$) {\(+1\)};
      \end{tikzpicture}
    \end{center}
    \caption{The pentagram game as a hypergraph.}
  \end{subfigure}
  \hfill{}
  \begin{subfigure}[t]{0.49\textwidth}
    \begin{center}
      \begin{tikzpicture}[vertex/.style={circle, thin, fill=blue!30, draw, inner sep=0, minimum size=5pt}]
        \node (00) [vertex] at (-1.25, 0) {};
        \node (01) [vertex] at (0,  0) {};
        \node (02) [vertex] at (1.25,  0) {};

        \node (10) [vertex] at (-1.25, -1.25) {};
        \node (11) [vertex] at (0,  -1.25) {};
        \node (12) [vertex] at (1.25,  -1.25) {};

        \node (20) [vertex] at (-1.25, -2.5) {};
        \node (21) [vertex] at (0,  -2.5) {};
        \node (22) [vertex] at (1.25, -2.5) {};
        
        \node (r0) [text=green!50!black!80] at (1.65, -0.05) {\(+1\)};
        \node (r1) [text=green!50!black!80] at (1.65, -1.20) {\(+1\)};
        \node (r2) [text=green!50!black!80] at (1.65, -2.45) {\(+1\)};
        
        \node (c0) [text=red!50!black!80] at (-1.2, -2.8) {\(-1\)};
        \node (c1) [text=red!50!black!80] at (-0.05, -2.8) {\(-1\)};
        \node (c2) [text=red!50!black!80] at (1.2, -2.8) {\(-1\)};

        \path[]
        (00) edge (01) edge (10)
        (01) edge (02) edge (11)
        (02) edge (12)
        
        (10) edge (11) edge (20)
        (11) edge (12) edge (21)
        (12) edge (22)

        (20) edge (21)
        (21) edge (22)
        ;
      \end{tikzpicture}
    \end{center}
    \caption{The magic square game as a hypergraph.}
  \end{subfigure}
  \caption{Examples of hypergraphs representing quantum magic games~\cite{arkhipov:2012}.\label{fig:as-graph}}
\end{figure}

We start by defining the notion of \emph{arrangements}, which are
configurations on which Mermin-style games may be
played. \cite{arkhipov:2012} defines both unsigned and signed
arrangements. Instead, we shall focus  on \emph{signed}
arrangements, and thus anytime we say ``arrangement'' we mean the
signed version.

\begin{definition}[Arrangement~\cite{arkhipov:2012}]\label{def:arrangement}
  An arrangement \(A = (V, E, \ell)\) is a finite connected hypergraph
  with vertex set \(V\) and hyperedge set \(E\), where a hyperedge is
  a nonempty subset of \(V\), such that every vertex \(v \in V\) lies
  in exactly two hyperedges \(e_{0}, e_{1} \in E\) (\emph{connected}
  means that the hypegraph cannot be split into two smaller disjoint
  hypergraphs). The labelling function \(\ell\colon E \to \{+1, -1\}\)
  maps each hyperedge to a sign \(+1\) or \(-1\).
\end{definition}

We will oftenly refer to a hyperedge as a \emph{line}. In
Figure~\ref{fig:as-graph} (a), the lines going through sequences of
four vertices are the hyperedges. Similarly, in
Figure~\ref{fig:as-graph} (b), the horizontal and vertical lines
touching the sequences of three vertices are the hyperedges.  As
already mentioned, arrangements define the configurations on which
games may be played.

\begin{definition}[Classical Realization~\cite{arkhipov:2012}]\label{def:classical-re}
  A classical realization of an arrangement \(A = (V, E, \ell)\) is a
  labelling \(c\colon V \to \{+1, -1\}\) that, for every hyperedge
  \(e \in E\), satisfies the property 
  \[
    \prod_{v \in e} c(v) = \ell(e).
  \]
\end{definition}


\begin{tcbexample}{Classical Realization}{class-re}
  Figure~\ref{fig:class-re} depicts an example of a classically
  realizable arrangement. That is, an arrangement for which there exists
  a classical realization.

  \begin{figure}[H]
    \begin{center}
      \begin{tikzpicture}[vertex/.style={circle, thin, fill=blue!30, draw, inner sep=0, minimum size=5pt}]
        \node (00) [vertex, label=above left:{\(v_{0}\)}] at (-1.25, 0) {};
        \node (01) [vertex, label=above left:{\(v_{1}\)}] at (0,  0) {};
        \node (02) [vertex, label=above left:{\(v_{2}\)}] at (1.25,  0) {};

        \node (10) [vertex, label=above left:{\(v_{3}\)}] at (-1.25, -1.25) {};
        \node (11) [vertex, label=above left:{\(v_{4}\)}] at (0,  -1.25) {};
        \node (12) [vertex, label=above left:{\(v_{5}\)}] at (1.25,  -1.25) {};

        \node (r0) [text=red!50!black!80] at (1.65, -0.05) {\(-1\)};
        \node (r1) [text=red!50!black!80] at (1.65, -1.20) {\(-1\)};
        
        \node (c0) [text=green!50!black!80] at (-1.2, -1.65) {\(+1\)};
        \node (c1) [text=green!50!black!80] at (-0.05, -1.65) {\(+1\)};
        \node (c2) [text=green!50!black!80] at (1.2, -1.65) {\(+1\)};

        \path[]
        (00) edge (01) edge (10)
        (01) edge (02) edge (11)
        (02) edge (12)
        
        (10) edge (11)
        (11) edge (12)
        ;
      \end{tikzpicture}
    \end{center}
    \caption{Example of a classically realizable arrangement.\label{fig:class-re}}
  \end{figure}

  A classical realization \(c\) for this arrangement is
  \begin{align*}
    c(v_{0}) = c(v_{1}) = c(v_{3}) = c(v_{4}) &= +1 \\
    c(v_{2}) = c(v_{5}) &= -1.
  \end{align*}
\end{tcbexample}


\begin{definition}[Quantum Realization~\cite{arkhipov:2012}]\label{def:quantum-re}
  A quantum realization of an arrangement \(A~=~(V, E, \ell)\) is a
  labelling \(q\colon V \to \operatorname{GL}(\mathcal{H})\) mapping
  each vertex of the arrangement to an observable \(M\) on a
  finite-dimensional Hilbert-space \(\mathcal{H}\), such that
  \begin{itemize}
  \item \(M\) is Hermitian and squares to the identity, or
    equivalently, has eigenvalues \(\pm{}1\).
    
  \item For each hyperedge, the observable assigned to its vertices
    pairwise commute and.
    
  \item For each hyperedge \(e \in E\), the labelling of its vertices
    satisfies the property
    \[
      \prod_{v \in e} q(v) = \ell(e) I.
    \]
  \end{itemize}
\end{definition}

A classical realization is simply a quantum realization in which
\(\mathcal{H} = \mathbb{R}\). As such, every classically realizable
arrangement is quantumly realizable. An example of quantum realization
was given in Section~\ref{sec:quantum-sol} for the magic square game.
Any arrangement that is quantumly realizable with observables that all
mutually commute is also classically
realizable~\cite[Proposition 8]{arkhipov:2012}. The proof follows by
the simultaneous diagonalization of the observables, similar to our
proof for Lemma~\ref{lem:product}.

It turns out that the existence of a realization of an arrangement
depends only on whether the number of \(-1\) labels is odd or
even. This is called the \emph{parity} of the arrangement.

\begin{definition}[Parity~\cite{arkhipov:2012}]\label{def:parity}
  The parity \(p(\ell)\) of an arrangement \(A = (V, E, \ell)\) is
  \[
    p(\ell) = \prod_{e \in E} \ell(E),
  \]
  which is \(-1\) if there is an odd number of \(-1\) labels, or \(+1\) otherwise.
\end{definition}

If there exists a realization (either classical or quantum) of an
arrangement \(A = (V, E, \ell)\), then it is possible to construct a
realization for \(A' = (V, E, \ell')\) from the realization of
\(A\)~\cite[Propositions 10 and 12]{arkhipov:2012}. Furthermore, an
arrangement is classically realizable if, and only if, its parity is
\(+1\)~\cite[Proposition 11]{arkhipov:2012}. Despite this fundamental result,
classically realizable arrangements are not as much interesting as the
quantumly ones. Therefore, the goal is to characterize the gap between
these two worlds. The arrangements that are quantumly realizable, but
are not classically realizable, are called \emph{magic} and are
defined as follows:

\begin{definition}[Magic Arrangement~\cite{arkhipov:2012}]\label{def:magic-arr}
  An arrangement is said magic if its parity is \(-1\) and there exists
  a quantum realization of it.
\end{definition}

The magic square and the pentagram are examples of magic arrangements.
Equipped with all these tools, we now define a generalization of \emph{parity}
pseudo-telepathy games (Mermin-style games):

\begin{definition}[Parity Pseudo-Telepathy Game~\cite{arkhipov:2012}]\label{def:parity-game}
  A parity pseudo-telepathy game on an arrangement \(A = (V, E, \ell)\) is
  a two-players cooperative game (say, played by Alice and Bob). The
  game is conducted by a referee Charlie. Alice and Bob may agree on a
  prior strategy, but cannot communicate once the game starts. At each
  round,
  \begin{enumerate}
  \item Charlie randomly picks a vertex \(u \in V\) and one of the hyperedges
    \(e \in E\) that contains \(u\).
    
  \item Charlie sends the vertex \(u\) to Alice and the hyperedge \(e\) to Bob.
    
  \item Alice labels the vertex \(u\) with \(a(u) = \pm{}1\) and sends
    \(a(u)\) to Charlie.

  \item Bob labels each vertex \(v \in e\) with \(b(v) = \pm{}1\) and sends
    each \(b(v)\) to Charlie.
    
  \item Alice and Bob win if \(a(u) = b(u)\) and \(\prod_{v} b(v) = \ell(e)\).
  \end{enumerate}
\end{definition}

Notice that the generalization above differs a bit from the magic
square game seen in Section~\ref{sec:magic-square}, where Alice
receives a hyperedge. This modification generalizes to
arrangements that do not share the property exhibited by the magic
square that its lines can be split into two disjoint sets (rows and
columns). In this sense, one can simply understand the magic square
game as a combination of two rounds. In the first ``half'' of the
round, Charlie sends the vertex \(u\) to Alice and the line \(e\) to
Bob. In the second half, Charlie sends \(u\) to Bob, but the other
line \(e'\) containing \(u\) to Alice.

There exists a strategy that wins with certainty a parity pseudo-telepathy
game played on a magic arrangement that has a quantum realization in
which all the operators have all real eigenvalues, provided that Alice
and Bob can share entanglement in advance~\cite[Theorem
17]{arkhipov:2012}. It suffices for them to share a maximally entangled
state
\[
  \rho_{AB} = \sum_{i = 0}^{n-1} \ket{i}\ket{i},
\]
where \(\{\ket{i}\}\) is a basis for the finite-dimensional
Hilbert-space \(\mathcal{H}\) of dimension \(n\). In the case of the
magic square, \(n = 4\) and
\(\{\ket{i}\} = \{\ket{0}, \ket{1}, \ket{2}, \ket{3}\}\), which,
rewritten as binary strings, is
\(\{\ket{00}, \ket{01}, \ket{10}, \ket{11}\}\). The proof is similar
to our proof for Theorem~\ref{theo:quantum-wins}, using the
simultaneous diagonalization of operators in the same hyperedge and
the symmetry of the state.

\subsection{Main Result: Characterization of Magic Arrangements by Planar Graphs}

We now move on to the main result of~\cite{arkhipov:2012}. We shall
derive a characterization of magic arrangements by the planarity of
its corresponding intersection graph.

\begin{definition}[Intersection Graph]\label{def:intersec}
  The intersection graph of an arrangement \(A = (V, E)\) is the
  undirected graph \(G = (V', E')\), where \(V' = E\), and there is an
  edge between two vertices \(e_{0}, e_{1} \in V'\) for each vertex in
  the insection of \(e_{0}\) and \(e_{1}\).
\end{definition}

The intersection graph of an arrangement is a dual representation in
which the roles of vertices and hyperedges are switched. The vertices
of the intersection graph are labelled with the same values of the
corresponding hyperedges in the arrangement. Similarly, a quantum
realization of the intersection graph assigns to its edges the same
measurements ascribed to the corresponding vertices in the
arrangement. The properties observed in the arrangement are also
carried to the intersection graph. In particular, the observables
assigned to the edges around a vertex in the intersection graph (by
around, we mean the edges that touch that vertex) mutually commute and
its product equals the identity times the label of the vertex. To
illustrate, the intersection graph of the magic square is the complete
bipartite graph on six vertices \(K_{3, 3}\) and the intersection
graph of the magic pentagram is the complete graph on five vertices
\(K_{5}\).

We are also going to need the definition of a topological minor:

\begin{definition}[Topological Minor]\label{def:topo}
  A graph \(H\) is a topological minor of \(G\) if there is an
  embedding of \(H\) in \(G\) that consists of an injective map
  \(\phi\) from every vertex \(v \in H\) to a vertex
  \(\phi(v) \in G\), and a map from each edge \((u, v) \in H\) to a
  simple path from \(\phi(u)\) to \(\phi(v)\) in G, such that these
  paths are disjoint (except on their endpoints).
\end{definition}

We now restate the main result of~\cite{arkhipov:2012} and its proof,
further illustrating it with examples.

\begin{theorem}\label{theo:main}
  An arrangement is magic if and only if its intersection graph is not
  planar.
\end{theorem}

We start by considering the direction that says that ``nonplanar
implies magic'', or equivalently, if the intersection graph is planar,
then its arrangement is not magic.

\begin{proof}
  First of all, assume that there exists a quantum realization of the
  arrangement (if there is none, then the arrangement is not magic).
  The goal is to show that, if there exists a quantum realization and
  the intersection graph is planar, then the parity of the arrangement
  is \(+1\) and, consequently, it is not magic. The strategy consists
  of repeatedly contracting edges of the intersection, and showing
  that contraction preserves a few properties. To contract an edge is
  to merge the two endpoints \(e_{0}\) and \(e_{1}\) into a new vertex
  \(e'\) (notice that we are using \(e\) to represent vertices,
  because these vertices correspond to hyperedges of the
  arrangement). Every edge that used to touch \(e_{0}\), now touches
  \(e'\), and every edge that used to touch \(e_{1}\), now touches
  \(e'\). Consequently, the edge that was contracted becomes two
  self-loops. Moreover, we define the label of the new vertex \(e'\)
  as the product of the labels of \(e_{0}\) and \(e_{1}\). We observe
  that contraction preserves the following properties:

  \begin{enumerate}
  \item The resulting graph remains planar.

  \item The parity (product of all the vertex labels) remains the
    same. This follows directly from the definition of the label of
    thenew vertex.

  \item The product of the labels of edges around any vertex, in
    cyclic order (say, without loss of generality, counterclockwise),
    equals the identity times the label of the vertex. To see this,
    first notice that this property holds for the initial graph, since
    all observables around a vertex pairwise commute (recall that
    these observables correspond to the observables assigned by the
    quantum realization to vertices that lie in the hyperedge in the
    arrangement). However, the commutative property does not
    necessarily hold after contraction. Nevertheless, if we follow a
    cyclic order, we can still see that this property is
    preserved. Let \(M_{0}, \ldots, M_{n-1}\) be the observables
    around a vertex \(e\), going counterclockwise. If
    \(M_{0} \ldots M_{n - 1} = \ell(e) I\), then for any starting
    point \(k\),
    \(M_{k} M_{k+1}\ldots M_{n-1}M_{0}\ldots M_{k-1} = \ell(e) I\),
    since
    \begin{align}
      M_{k}M_{k+1} \ldots M_{n-1}M_{0}\ldots M_{k-1}
      &= (M_{k-1}\ldots M_{0})(M_{0} \ldots M_{n-1})(M_{0}\ldots M_{k-1})  \label{eq:cyclic1} \\
      &= (M_{k-1}\ldots M_{0})\ell(e) I(M_{0}\ldots M_{k-1}) \\
      &= \ell(e) I,  \label{eq:cyclic2}
    \end{align}
    where (\ref{eq:cyclic1}) follows from the fact that
    \(M_{i} M_{i} = I\). Now, let \(X\) be the measurement assigned to
    the edge that is being contracted and let the labels around its
    endpoints \(e_{0}\) and \(e_{1}\) be \(M_{0}\ldots M_{m-1}X\) and
    \(X N_{0}\ldots N_{n-1}\) going counterclockwise. Then,
    \[
      M_{0} \ldots M_{m-1} X = \ell(e_{0})I
    \]
    and
    \[
      X N_{0} \ldots N_{n-1} = \ell(e_{1})I.
    \]
    Multiplying these gives
    \[
      M_{0}\ldots M_{m-1} X^{2} N_{0} \ldots N_{n-1} =
      M_{0}\ldots M_{m-1} N_{0} \ldots N_{n-1} =
      \ell(e_{0}) \ell(e_{1}) I = \ell(e') I,
    \]
    so the product of the observables around the new vertex \(e'\)
    still is the identity times its label. Notice that key to this
    strategy is the fact that the graph is planar, and thus we can
    draw the edges around the new vertex without mixing the edges that
    used to touch \(e_{0}\) and \(e_{1}\).
  \end{enumerate}

  By repeatedly contracting edges, eventually we reach a graph with a
  single vertex.  Due to how we defined the label of each new vertex
  (i.e.\ as the product of the labels of the vertices being merged),
  it follows that the label of the last vertex equals the product of
  the labels of all the original vertices, and therefore equals the
  parity of the arrangement. The remaining vertex has multiple
  self-loops, two for each measurement \(M\) ascribed to the original
  edges.  Since \(M^{2} = I\), going counterclockwise we get a
  sequence \(M_{0}^{2} \ldots M_{\vert E'\vert -1}^{2} = I\). But, we
  saw that contraction preserves the third property, which says that
  the observables around a vertex multiply to the identity times the
  vertex label. Thus, the label of the final vertex is \(1\) and,
  consequently, the parity of the arrangement is \(+1\). \qed
\end{proof}

\begin{tcbexample}{Planar Graph \(\implies\) Not Magic}{planar-nmagic}
  Consider the arrangement depicted in Figure~\ref{fig:class-re} and
  assume there exists a quantum realization that assigns the
  observables \(M_{i}\) to each vertex \(v_{i}\). Suppose that we do
  not know that the parity of this arrangement is \(+1\). We are going
  to follow the strategy described above, to show that its parity must
  be \(+1\). Figure~\ref{fig:class-re-inters} shows the intersection graph
  that corresponds to that arrangement.

  \begin{figure}[H]
    \begin{center}
      \begin{tikzpicture}[vertex/.style={circle, thin, fill=blue!30, draw, inner sep=0, minimum size=5pt}]
        \node (line0) [vertex, label=above:{\(e_{0}\)}] at (0, 0) {};
        \node (line1) [vertex, label=below:{\(e_{1}\)}] at (0, -3) {};
        \node (col0) [vertex, label=left:{\(e_{2}\)}] at (-1.5, -1.5) {};
        \node (col1) [vertex, label=right:{\(e_{3}\)}] at (0, -1.5) {};
        \node (col2) [vertex, label=right:{\(e_{4}\)}] at (1.5, -1.5) {};
        \path[]
        (line0) edge node[sloped, above] {\(M_{0}\)} (col0)
        (line0) edge node[midway, fill=gray!15] {\(M_{1}\)} (col1)
        (line0) edge node[sloped, above] {\(M_{2}\)} (col2)
        (line1) edge node[sloped, below] {\(M_{3}\)} (col0)
        (line1) edge node[midway, fill=gray!15] {\(M_{4}\)} (col1)
        (line1) edge node[sloped, below] {\(M_{5}\)} (col2)
        ;
      \end{tikzpicture}
    \end{center}
    \caption{Intersection graph corresponding to the arrangement seen
      in Figure~\ref{fig:class-re}.\label{fig:class-re-inters}}
  \end{figure}

  Let us contract the edge labelled by \(M_{0}\) (recall that it
  corresponds to the vertex \(v_{0}\) in the arrangement). The
  resulting graph is depicted in Figure~\ref{fig:contract0}.  Notice
  that \(M_{1}M_{2}M_{0} = \ell(e_{0}) I\) and
  \(M_{0}M_{3} = \ell(e_{2}) I\). After contraction, we have
  a new vertex \(e'_{0}\), with \(\ell(e'_{0}) = \ell(e_{0})\ell(e_{2})\)
  and \(M_{1}M_{2}M_{0}^{2}M_{3} = \ell(e_{0})\ell(e_{2}) I = \ell(e'_{0}) I\).

    \begin{figure}[H]
    \begin{center}
      \begin{tikzpicture}[
        vertex/.style={circle, thin, fill=blue!30, draw, inner sep=0, minimum size=5pt},
        every loop/.style={}
        ]
        \node (line1) [vertex, label=below:{\(e_{1}\)}] at (0, -3) {};
        \node (e'0) [vertex, label=left:{\(e'_{0}\)}] at (-1.5, -1.5) {};
        \node (col1) [vertex, label=right:{\(e_{3}\)}] at (0, -1.5) {};
        \node (col2) [vertex, label=right:{\(e_{4}\)}] at (1.5, -1.5) {};
        \path[]
        (e'0) edge[loop above, in=120, out=60, min distance=5mm] node {\(M_{0}^{2}\)} (e'0)
        (e'0) edge node[midway, fill=gray!15] {\(M_{1}\)} (col1)
        (e'0) edge[bend left=45] node[sloped, above] {\(M_{2}\)} (col2)
        (line1) edge node[sloped, below] {\(M_{3}\)} (e'0)
        (line1) edge node[midway, fill=gray!15] {\(M_{4}\)} (col1)
        (line1) edge node[sloped, below] {\(M_{5}\)} (col2)
        ;
      \end{tikzpicture}
    \end{center}
    \caption{Graph that results from the contraction of the edge from
      \(e_{0}\) to \(e_{2}\) in Figure~\ref{fig:class-re-inters}.\label{fig:contract0}}
  \end{figure}

  Let us now contract the edge labelled by \(M_{5}\). The resulting graph
  is shown in Figure~\ref{fig:contract5}.

  \begin{figure}[H]
    \begin{center}
      \begin{tikzpicture}[
        vertex/.style={circle, thin, fill=blue!30, draw, inner sep=0, minimum size=5pt},
        every loop/.style={}
        ]
        \node (e'0) [vertex, label=left:{\(e'_{0}\)}] at (-1.5, -1.5) {};
        \node (col1) [vertex, label=below:{\(e_{3}\)}] at (0, -1.5) {};
        \node (e'1) [vertex, label=right:{\(e'_{1}\)}] at (1.5, -1.5) {};
        \path[]
        (e'0) edge[loop above, in=120, out=60, min distance=5mm] node {\(M_{0}^{2}\)} (e'0)
        (e'0) edge node[midway, fill=gray!15] {\(M_{1}\)} (col1)
        (e'0) edge[bend left=45] node[sloped, above] {\(M_{2}\)} (col2)
        (e'0) edge[bend right=45] node[sloped, below] {\(M_{3}\)} (e'1)
        (e'1) edge node[midway, fill=gray!15] {\(M_{4}\)} (col1)
        (e'1) edge[loop above, in=120, out=60, min distance=5mm] node {\(M_{5}^{2}\)} (e'1)
        ;
      \end{tikzpicture}
    \end{center}
    \caption{Graph that results from the contraction of the edge from
      \(e_{1}\) to \(e_{4}\) in Figure~\ref{fig:contract0}.\label{fig:contract5}}
  \end{figure}

  If we keep contracting edges, eventually we reach a graph with a
  single node, whose observables going counterclockwise are
  \(\prod_{i = 0}^{5} M_{i}^{2} = I\). And, because contracting edges
  preserve the cyclic product property, the product of the observables is the
  identity times the label of the last vertex. Hence, the parity of
  this arrangement is \(+1\) (as we already knew).
\end{tcbexample}

It remains to show the other direction of the result. That is, if the
intersection graph of an arrangement is nonplanar, than the
arrangement is magic.

\begin{proof}
  By the Pontyagin-Kuratowski theorem, everry nonplanar graph contains either
  the \(K_{5}\) or the \(K_{3,3}\) graph as a topological minor. We have already seen
  that the \(K_{3, 3}\) is the intersection graph that corresponds to the magic square
  and that the \(K_{5}\) corresponds to the magic pentagram, and both are magic
  arrangements. Hence, it suffices to demonstrate that, if the intersection graph
  \(G\) of an arrangement has a magic intersection graph \(H\) as a topological minor,
  than \(G\) is magic. For that, we are going to construct a quantum realization
  of \(G\) from the realization of \(H\), as follows:

  \begin{enumerate}
  \item For every vertex in \(H\), assume that the corresponding vertex in
    \(G\) is labelled in the same way.
    
  \item Assume that the label of every other vertex is \(+1\).
    
  \item For every edge of \(H\), label each edge of the corresponding  path in \(G\) with
    the same observable.

  \item Label the remaining edges of \(G\) as the identity.
  \end{enumerate}

  To see why items (1) and (2) are safe to assume, recall that an
  arrangement depends only on its parity (meaning that it is possible
  to construct a realization for another arrangement on the same
  vertices and hyperedges and of same parity), and thus it does not
  matter how you label the vertices of \(G\), as long as its parity
  is \(-1\). It remains to show that the strategy above gives a
  quantum realization of \(G\). For that, we check each of the
  properties of a quantum realization:

  \begin{enumerate}
  \item Every observable \(M\) assigned to a vertex of \(G\) is either one in \(H\) or
    the identity. Hence, \(M\) is Hermitian and squares to the identity.

  \item Every vertex of \(G\) corresponding to a vertex of \(H\) is
    surrounded by the same observables on its edges, plus (possibly)
    copies of the identity. Therefore, these operators mutually
    commute. Furthermore, they multiply to the identity times the
    label of the vertex, which is labelled in the same way as its
    corresponding vertex in \(H\).

  \item Every vertex of \(G\) that lies on a simple path corresponding
    to an edge in \(H\) touches two edges (in and out) labelled with
    the same operator \(M\), which is the operator of the edge in
    \(H\), plus (possibly) copies of the identity. Since
    \(M^{2} = I\), these operators all commute and multiply to
    \(+I\). Recall that we labelled these vertices as \(+1\), as they
    do not have a correspondence in \(H\). Hence, the product of the
    operators multiply to the identity times the vertex's label, as
    desired.

  \item Any other vertex of \(G\) is labelled as \(+1\) and is only
    surrounded by edges labelled as \(+I\), which clearly commute
    and multiply to \(+I\), i.e.\ the identity times the label of the vertex.
  \end{enumerate}
  \qed
\end{proof}

\begin{tcbexample}{Nonplanar Graph \(\implies\) Magic}{nplanar-magic}
  Recall that the complete bipartite graph \(K_{3, 3}\) is the intersection
  graph of the magic square. Figure~\ref{fig:k33} shows the
  \(K_{3, 3}\), labelled accordingly to the magic square game
  described in Section~\ref{sec:magic-square}.

  \begin{figure}[H]
    \begin{center}
      \begin{tikzpicture}[vertex/.style={circle, thin, fill=blue!30, draw, inner sep=0, minimum size=5pt}]
        \node (e'0) [vertex, label=above right:{\(e'_{0}\)}, label=above left:{\color{green!50!black!80}\(+I\)}] at (0, 0) {};
        \node (e'1) [vertex, label=above right:{\(e'_{1}\)}, label=above left:{\color{green!50!black!80}\(+I\)}] at (4, 0) {};
        \node (e'2) [vertex, label=above right:{\(e'_{2}\)}, label=above left:{\color{green!50!black!80}\(+I\)}] at (8, 0) {};
        \node (e'3) [vertex, label=below right:{\(e'_{3}\)}, label=below left:{\color{red!50!black!80}\(-I\)}] at (0, -3) {};
        \node (e'4) [vertex, label=below right:{\(e'_{4}\)}, label=below left:{\color{red!50!black!80}\(-I\)}] at (4, -3) {};
        \node (e'5) [vertex, label=below right:{\(e'_{5}\)}, label=below left:{\color{red!50!black!80}\(-I\)}] at (8, -3) {};

        \path[]
        (e'0) edge node[midway, fill=gray!15] {\(I \otimes Z\)} (e'3)
        edge node[near start, fill=gray!15, xshift=-.3cm] {\(Z \otimes I\)} (e'4)
        edge node[near start, fill=gray!15] {\(Z \otimes Z\)} (e'5)

        (e'1) edge node[near end, fill=gray!15] {\(X \otimes I\)} (e'3)
        edge node[near end, fill=gray!15] {\(I \otimes X\)} (e'4)
        edge node[near end, fill=gray!15, xshift=0.3cm] {\(X \otimes X\)} (e'5)
        
        (e'2) edge node[near start, fill=gray!15, xshift=-0.1cm, yshift=.1cm] {\(-X \otimes Z\)} (e'3)
        edge node[near start, fill=gray!15, xshift=0.3cm] {\(-Z \otimes X\)} (e'4)
        edge node[midway, fill=gray!15] {\(Y \otimes Y\)} (e'5)
        ;
      \end{tikzpicture}
    \end{center}
    \caption{\(K_{3, 3}\) corresponding to the magic square arrangement.\label{fig:k33}}
  \end{figure}
  Consider the Petersen graph shown in Figure~\ref{fig:petersen} (a).
  Figure~\ref{fig:petersen} (b) shows the same graph, rewritten in a
  way that it is easy to see that it has the \(K_{3, 3}\) graph as a
  topological minor.

  \begin{figure}[H]
    \begin{subfigure}{0.475\textwidth}
      \begin{center}
        \begin{tikzpicture}[vertex/.style={circle, thin, fill=blue!30, draw, inner sep=0, minimum size=5pt}]
          \foreach \l [
          count=\c,
          evaluate=\c as \ang using {18 + 72*\c},
          evaluate=\c as \e using {iseven(\c - 1)?"{\color{green!50!black!80}+I}":"{\color{red!50!black!80}-I}"}
          ] in {0, 1, 2, 3, 4} {
            \node [vertex] (e\l) at (\ang:20mm) {};
            \node at (\ang:24mm) {\(e_{\l}\)};
            \node at ({\ang + 11}:22mm) {\(\e\)};
          }

          \foreach \l [
          count=\c,
          evaluate=\c as \ang using {18 + 72*\c},
          evaluate=\c as \e using {\c>1?"{\color{green!50!black!80}+I}":"{\color{red!50!black!80}-I}"}
          ] in {5, 6, 7, 8, 9} {
            \node [vertex] (e\l) at (\ang:10mm) {};
            \node at ({\ang - 18}:12mm) {\(e_{\l}\)};
            \node at ({\ang + 18}:12mm) {\(\e\)};
          }

          \path[]
          (e0) edge (e1) edge (e4) edge (e5)
          (e1) edge (e2) edge (e6)
          (e2) edge (e3) edge (e7)
          (e3) edge (e8) edge (e4)
          (e4) edge (e9)
          (e5) edge (e7) edge (e8)
          (e6) edge (e8) edge (e9)
          (e7) edge (e9)
          ;
        \end{tikzpicture}
      \end{center}
      \caption{}
    \end{subfigure}
    \hfill{}
    \begin{subfigure}{0.475\textwidth}
      \begin{center}
        \begin{tikzpicture}[vertex/.style={circle, thin, fill=blue!30, draw, inner sep=0, minimum size=5pt}]
          \node (e0) [vertex, label=left:{\(e_{0}\)}] at (0, 0) {};
          \node (e2) [vertex, label=left:{\(e_{2}\)}] at (2.5, 0) {};
          \node (e8) [vertex, label=left:{\(e_{8}\)}] at (5, 0) {};
          \node (e1) [vertex, label=left:{\(e_{1}\)}] at (0, -2) {};
          \node (e3) [vertex, label=left:{\(e_{3}\)}] at (2.5, -2) {};
          \node (e5) [vertex, label=below:{\(e_{5}\)}] at (5, -2) {};

          \node (e4) [vertex, label=above:{\(e_{4}\)}] at (1.25, 0) {};
          \node (e6) [vertex, label=below:{\(e_{6}\)}] at (1.25, -2) {};
          \node (e7) [vertex, label=left:{\(e_{7}\)}] at (3.75, -2) {};
          \node (e9) [vertex, label=left:{\(e_{9}\)}] at (3.75, 0) {};

          \path[]
          (e0) edge (e1) edge (e4) edge (e5)
          (e1) edge (e2) edge (e6)
          (e2) edge (e3) edge (e7)
          (e3) edge (e8) edge (e4)
          (e4) edge[bend left] (e9)
          (e5) edge (e7) edge (e8)
          (e6) edge (e8) edge (e9)
          (e7) edge (e9)
          ;
        \end{tikzpicture}
      \end{center}
      \caption{}
    \end{subfigure}
    \caption{Petersen graph.\label{fig:petersen}}
  \end{figure}

  Let \(\phi\) be the function mapping vertices from \(K_{3, 3}\)
  graph to the Petersen graph. Then,
  \begin{align*}
    \phi(e'_{0}) &= e_{0} \\
    \phi(e'_{1}) &= e_{2} \\
    \phi(e'_{2}) &= e_{8} \\
    \phi(e'_{3}) &= e_{1} \\
    \phi(e'_{4}) &= e_{3} \\
    \phi(e'_{5}) &= e_{5}.
  \end{align*}

  Following the proof of Theorem~\ref{theo:main}, we assume that the
  vertices with a correspondence in the \(K_{3, 3}\) graph are
  labelled in the same way, and the remaining are labelled with
  \(+I\).  To construct a quantum realization of the Petersen graph,
  we first look for simple paths that correspond to edges in
  \(K_{3, 3}\). For example, the edge \((e_{0}, e_{1})\) in Petersen
  corresponds exactly to the edge \((e'_{0}, e'_{3})\) in
  \(K_{3, 3}\), so we assign the operator \(I \otimes Z\) to
  it. Similarly, the path \((e_{0}, e_{4}, e_{3})\) in Petersen
  corresponds to the edge \((e'_{0}, e'_{4})\) in \(K_{3, 3}\), so we
  assign the operator \(Z \otimes I\) to both edges \((e_{0}, e_{4})\)
  and \((e_{4}, e_{3})\). We keep doing this for every path that has a
  correspondence in the \(K_{3, 3}\) graph. Then, we label the
  remaining edges with \(+I\). Figure~\ref{fig:petersen-final} shows
  the quantum realization constructed for the Petersen graph.

  \begin{figure}[H]
    \begin{center}
      \begin{tikzpicture}[vertex/.style={circle, thin, fill=blue!30, draw, inner sep=0, minimum size=5pt}]
        \foreach \l [
        count=\c,
        evaluate=\c as \ang using {18 + 72*\c},
        evaluate=\c as \e using {iseven(\c - 1)?"{\color{green!50!black!80}+I}":"{\color{red!50!black!80}-I}"}
        ] in {0, 1, 2, 3, 4} {
          \node [vertex] (e\l) at (\ang:30mm) {};
          \node at (\ang:34mm) {\(e_{\l}\)};
          \node at ({\ang + 8}:32mm) {\(\e\)};
        }

        \foreach \l [
        count=\c,
        evaluate=\c as \ang using {18 + 72*\c},
        evaluate=\c as \e using {\c>1?"{\color{green!50!black!80}+I}":"{\color{red!50!black!80}-I}"}
        ] in {5, 6, 7, 8, 9} {
          \node [vertex] (e\l) at (\ang:20mm) {};
          \node at ({\ang - 10}:20mm) {\(e_{\l}\)};
          \node at ({\ang + 13}:20mm) {\(\e\)};
        }

        \path[]
        (e0) edge node[midway, fill=gray!15] {\(I \otimes Z\)} (e1)
        edge node[midway, fill=gray!15] {\(Z \otimes I\)} (e4)
        edge node[midway, fill=gray!15] {\(Z \otimes Z\)} (e5)
        (e1) edge node[midway, fill=gray!15] {\(X \otimes I\)} (e2)
        edge node[midway, fill=gray!15, rotate=80] {\(-X \otimes Z\)} (e6)
        (e2) edge node[midway, fill=gray!15] {\(I \otimes X\)} (e3)
        edge node[midway, fill=gray!15, rotate=-30] {\(X \otimes X\)} (e7)
        (e3) edge node[midway, fill=gray!15, rotate=30] {\(-Z \otimes X\)} (e8)
        edge node[midway, fill=gray!15] {\(Z \otimes I\)} (e4)
        (e4) edge node[midway, fill=gray!15, rotate=-30] {\(+I\)} (e9)
        (e5) edge node[midway, fill=gray!15] {\(X \otimes X\)} (e7) edge node[midway, fill=gray!15] {\(Y \otimes Y\)} (e8)
        (e6) edge node[midway, fill=gray!15, rotate=45] {\(-X \otimes Z\)} (e8)
        edge node[midway, fill=gray!15] {\(+I\)} (e9)
        (e7) edge node[midway, fill=gray!15, rotate=-45] {\(+I\)} (e9)
        ;
      \end{tikzpicture}
    \end{center}
    \caption{Quantum realiation of the Petersen graph, constructed from \(K_{3, 3}\) (magic square)}
    \label{fig:petersen-final}
  \end{figure}
\end{tcbexample}

\section{Conclusion}\label{sec:conc}
In this work, we described the two-players cooperative quantum magic
game known as the magic square game, that exhibits the so-called
property of pseudo-telepathy. In other words, it is a game that is
impossible to systematically win under classical assumptions (i.e.\
when restricted to a classical solution, if the players are always
winning, the referee can suspect that they are somehow cheating and
communicating), but that there exists a quantum strategy that wins
every round with certainty, which gives the impression that some sort
of communication is going on (hence ``pseudo-telepathy'').
We described the classical and quantum strategies, showed why
the quantum approach works, and how to implement it with
quantum circuits. We also briefly discussed the connection between the
magic square game and the Kochen-Specker theorem, which states the
incompatibility between a quantum mechanics model that is both
noncontextual and deterministic.

We concluded by describing a generalization of games that follow the same
style of the magic square, also known as Mermin-style games, given by
Arkhipov~\cite{arkhipov:2012}. In this generalization, the quantum
games are represented by hypergraphs whose hyperedges encode the
constraints of the game and whose vertices must be labelled by the
players in a way that this labelling respects those constraints. In the
case of the magic square, the hyperedges are the three rows and three
columns, and the vertices are each cell of the grid. Arkhipov showed
in his work that there exists a subset of these games that are
``magical'' in the sense that they cannot be won classically, but they
admit a quantum strategy. This quantum solution, as in the magic
square case, consists of the two players sharing a symmetric,
entangled state. Furthermore, the arrangement on which these games are
played can be characterized in terms of the (non)planarity of the
corresponding intersection graphs: the arrangement is magic if, and
only if, its intersection graph is nonplanar.


\printbibliography{}
\end{document}
